module.exports = {

"[externals]/ [external] (next/dist/compiled/next-server/app-route.runtime.dev.js, cjs)": (function(__turbopack_context__) {

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, m: module, e: exports, t: require } = __turbopack_context__;
{
const mod = __turbopack_external_require__("next/dist/compiled/next-server/app-route.runtime.dev.js");

module.exports = mod;
}}),
"[externals]/ [external] (@opentelemetry/api, cjs)": (function(__turbopack_context__) {

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, m: module, e: exports, t: require } = __turbopack_context__;
{
const mod = __turbopack_external_require__("@opentelemetry/api");

module.exports = mod;
}}),
"[externals]/ [external] (next/dist/compiled/next-server/app-page.runtime.dev.js, cjs)": (function(__turbopack_context__) {

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, m: module, e: exports, t: require } = __turbopack_context__;
{
const mod = __turbopack_external_require__("next/dist/compiled/next-server/app-page.runtime.dev.js");

module.exports = mod;
}}),
"[externals]/ [external] (next/dist/server/app-render/work-unit-async-storage.external.js, cjs)": (function(__turbopack_context__) {

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, m: module, e: exports, t: require } = __turbopack_context__;
{
const mod = __turbopack_external_require__("next/dist/server/app-render/work-unit-async-storage.external.js");

module.exports = mod;
}}),
"[externals]/ [external] (next/dist/server/app-render/work-async-storage.external.js, cjs)": (function(__turbopack_context__) {

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, m: module, e: exports, t: require } = __turbopack_context__;
{
const mod = __turbopack_external_require__("next/dist/server/app-render/work-async-storage.external.js");

module.exports = mod;
}}),
"[project]/lib/supabase-admin.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, z: require } = __turbopack_context__;
{
__turbopack_esm__({
    "createCompany": (()=>createCompany),
    "createStore": (()=>createStore),
    "createUser": (()=>createUser),
    "default": (()=>__TURBOPACK__default__export__),
    "deleteUser": (()=>deleteUser),
    "getAllCompanies": (()=>getAllCompanies),
    "getAllStores": (()=>getAllStores),
    "getAllUsers": (()=>getAllUsers),
    "getCompanyById": (()=>getCompanyById),
    "getStoreById": (()=>getStoreById),
    "getStoresByCompany": (()=>getStoresByCompany),
    "getUserById": (()=>getUserById),
    "getUsersByCompany": (()=>getUsersByCompany),
    "supabaseAdmin": (()=>supabaseAdmin),
    "updateCompany": (()=>updateCompany),
    "updateStore": (()=>updateStore),
    "updateUser": (()=>updateUser),
    "verifyToken": (()=>verifyToken)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$supabase$2f$supabase$2d$js$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_import__("[project]/node_modules/@supabase/supabase-js/dist/index.mjs [app-route] (ecmascript) <locals>");
;
// URL e Service Key do Supabase (server-side only)
const supabaseUrl = process.env.SUPABASE_URL || ("TURBOPACK compile-time value", "https://eetduqcmjucslzedsotg.supabase.co") || 'http://kong:8000';
const supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY || process.env.SUPABASE_SECRET_KEY || process.env.SUPABASE_SERVICE_KEY || '';
if (!supabaseServiceKey) {
    console.warn('??  SUPABASE_SERVICE_ROLE_KEY or SUPABASE_SECRET_KEY not set - admin client will not work');
}
const supabaseAdmin = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$supabase$2f$supabase$2d$js$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["createClient"])(supabaseUrl, supabaseServiceKey, {
    auth: {
        autoRefreshToken: false,
        persistSession: false
    }
});
function mapUserRow(row) {
    const lastSeen = row.last_seen ?? null;
    const isOnline = lastSeen ? Date.now() - new Date(lastSeen).getTime() < 5 * 60 * 1000 : false;
    return {
        id: row.id,
        email: row.email,
        displayName: row.display_name || row.email || 'Sem nome',
        role: row.role,
        companyId: row.company_id,
        storeId: row.store_id,
        storeIds: Array.isArray(row.store_ids) ? row.store_ids : row.store_id ? [
            row.store_id
        ] : [],
        active: row.active !== false,
        createdAt: row.created_at,
        lastSeen,
        isOnline
    };
}
function mapCompanyRow(row) {
    return {
        id: row.id,
        name: row.name,
        tradingName: row.trading_name ?? undefined,
        cnpj: row.cnpj ?? undefined,
        active: row.active !== false,
        createdAt: row.created_at,
        updatedAt: row.updated_at
    };
}
function mapStoreRow(row) {
    return {
        id: row.id,
        name: row.name,
        code: row.code,
        companyId: row.company_id,
        managerId: row.manager_id ?? null,
        agentId: row.agent_id ?? null,
        address: row.address ?? undefined,
        city: row.city ?? undefined,
        state: row.state ?? undefined,
        active: row.active !== false,
        createdAt: row.created_at,
        updatedAt: row.updated_at
    };
}
async function getAllUsers() {
    const { data, error } = await supabaseAdmin.from('users').select('*').order('created_at', {
        ascending: false
    });
    if (error) throw error;
    return (data || []).map(mapUserRow);
}
async function getUserById(userId) {
    const { data, error } = await supabaseAdmin.from('users').select('*').eq('id', userId).single();
    if (error) throw error;
    return mapUserRow(data);
}
async function getUsersByCompany(companyId) {
    const { data, error } = await supabaseAdmin.from('users').select('*').eq('company_id', companyId).order('created_at', {
        ascending: false
    });
    if (error) throw error;
    return (data || []).map(mapUserRow);
}
async function createUser(user) {
    const payload = {
        id: user.id,
        email: user.email,
        display_name: user.displayName ?? null,
        role: user.role,
        company_id: user.companyId ?? null,
        store_id: user.storeId ?? null,
        store_ids: user.storeIds ?? (user.storeId ? [
            user.storeId
        ] : []),
        active: user.active ?? true
    };
    const { data, error } = await supabaseAdmin.from('users').insert(payload).select().single();
    if (error) throw error;
    return mapUserRow(data);
}
async function updateUser(userId, updates) {
    const payload = {
        display_name: updates.displayName,
        role: updates.role,
        company_id: updates.companyId ?? undefined,
        store_id: updates.storeId ?? undefined,
        store_ids: updates.storeIds,
        active: typeof updates.active === 'boolean' ? updates.active : undefined,
        updated_at: new Date().toISOString()
    };
    const { data, error } = await supabaseAdmin.from('users').update(payload).eq('id', userId).select().single();
    if (error) throw error;
    return mapUserRow(data);
}
async function deleteUser(userId) {
    const { error } = await supabaseAdmin.from('users').delete().eq('id', userId);
    if (error) throw error;
}
async function getAllCompanies() {
    const { data, error } = await supabaseAdmin.from('companies').select('*').order('name', {
        ascending: true
    });
    if (error) throw error;
    return (data || []).map(mapCompanyRow);
}
async function getCompanyById(companyId) {
    const { data, error } = await supabaseAdmin.from('companies').select('*').eq('id', companyId).single();
    if (error) throw error;
    return mapCompanyRow(data);
}
async function createCompany(company) {
    const payload = {
        id: company.id,
        name: company.name,
        trading_name: company.tradingName ?? null,
        cnpj: company.cnpj ?? null,
        active: company.active ?? true
    };
    const { data, error } = await supabaseAdmin.from('companies').insert(payload).select().single();
    if (error) throw error;
    return mapCompanyRow(data);
}
async function updateCompany(companyId, updates) {
    const payload = {
        name: updates.name,
        trading_name: updates.tradingName ?? undefined,
        cnpj: updates.cnpj ?? undefined,
        active: typeof updates.active === 'boolean' ? updates.active : undefined,
        updated_at: new Date().toISOString()
    };
    const { data, error } = await supabaseAdmin.from('companies').update(payload).eq('id', companyId).select().single();
    if (error) throw error;
    return mapCompanyRow(data);
}
async function getAllStores() {
    const { data, error } = await supabaseAdmin.from('stores').select('*').order('name', {
        ascending: true
    });
    if (error) throw error;
    return (data || []).map(mapStoreRow);
}
async function getStoresByCompany(companyId) {
    const { data, error } = await supabaseAdmin.from('stores').select('*').eq('company_id', companyId).order('name', {
        ascending: true
    });
    if (error) throw error;
    return (data || []).map(mapStoreRow);
}
async function getStoreById(storeId) {
    const { data, error } = await supabaseAdmin.from('stores').select('*').eq('id', storeId).single();
    if (error) throw error;
    return mapStoreRow(data);
}
async function createStore(store) {
    const payload = {
        id: store.id,
        name: store.name,
        code: store.code,
        company_id: store.companyId,
        manager_id: store.managerId ?? null,
        agent_id: store.agentId ?? null,
        address: store.address ?? null,
        city: store.city ?? null,
        state: store.state ?? null,
        active: store.active ?? true
    };
    const { data, error } = await supabaseAdmin.from('stores').insert(payload).select().single();
    if (error) throw error;
    return mapStoreRow(data);
}
async function updateStore(storeId, updates) {
    const payload = {
        name: updates.name,
        code: updates.code,
        company_id: updates.companyId,
        manager_id: updates.managerId ?? undefined,
        agent_id: updates.agentId ?? undefined,
        address: updates.address ?? undefined,
        city: updates.city ?? undefined,
        state: updates.state ?? undefined,
        active: typeof updates.active === 'boolean' ? updates.active : undefined,
        updated_at: new Date().toISOString()
    };
    const { data, error } = await supabaseAdmin.from('stores').update(payload).eq('id', storeId).select().single();
    if (error) throw error;
    return mapStoreRow(data);
}
async function verifyToken(token) {
    const { data: { user }, error } = await supabaseAdmin.auth.getUser(token);
    if (error) throw error;
    return user;
}
const __TURBOPACK__default__export__ = supabaseAdmin;
}}),
"[project]/app/api/monitoring/health/route.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, z: require } = __turbopack_context__;
{
__turbopack_esm__({
    "GET": (()=>GET),
    "dynamic": (()=>dynamic)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/node_modules/next/server.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$supabase$2d$admin$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/lib/supabase-admin.ts [app-route] (ecmascript)");
;
;
const dynamic = 'force-dynamic';
async function GET() {
    const results = [];
    const startTime = Date.now();
    // 1. Verificar Database (Supabase)
    const dbStart = Date.now();
    try {
        const { error } = await __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$supabase$2d$admin$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["supabaseAdmin"].from('users').select('count').limit(1);
        results.push({
            check_type: 'database',
            endpoint: 'supabase',
            status: error ? 'unhealthy' : 'healthy',
            response_time_ms: Date.now() - dbStart,
            error_message: error?.message
        });
    } catch (err) {
        results.push({
            check_type: 'database',
            endpoint: 'supabase',
            status: 'unhealthy',
            response_time_ms: Date.now() - dbStart,
            error_message: err.message
        });
    }
    // 2. Verificar Auth
    const authStart = Date.now();
    try {
        const { error } = await __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$supabase$2d$admin$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["supabaseAdmin"].auth.getSession();
        results.push({
            check_type: 'auth',
            endpoint: 'supabase-auth',
            status: error ? 'degraded' : 'healthy',
            response_time_ms: Date.now() - authStart,
            error_message: error?.message
        });
    } catch (err) {
        results.push({
            check_type: 'auth',
            endpoint: 'supabase-auth',
            status: 'unhealthy',
            response_time_ms: Date.now() - authStart,
            error_message: err.message
        });
    }
    // 3. Verificar APIs principais
    const apiEndpoints = [
        {
            name: 'dashboard',
            path: '/api/dashboard'
        },
        {
            name: 'usuarios',
            path: '/api/usuarios'
        },
        {
            name: 'solicitacoes',
            path: '/api/solicitacoes'
        }
    ];
    for (const api of apiEndpoints){
        const apiStart = Date.now();
        try {
            const baseUrl = ("TURBOPACK compile-time value", "http://localhost:3000") || 'http://localhost:3000';
            const response = await fetch(`${baseUrl}${api.path}`, {
                method: 'GET',
                signal: AbortSignal.timeout(5000)
            });
            let status = 'healthy';
            if (response.status >= 500) status = 'unhealthy';
            else if (response.status >= 400) status = 'degraded';
            results.push({
                check_type: 'api',
                endpoint: api.path,
                status,
                response_time_ms: Date.now() - apiStart,
                status_code: response.status
            });
        } catch (err) {
            results.push({
                check_type: 'api',
                endpoint: api.path,
                status: 'unhealthy',
                response_time_ms: Date.now() - apiStart,
                error_message: err.message
            });
        }
    }
    // Salvar resultados no banco
    for (const result of results){
        // Tentar insert direto
        const { error } = await __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$supabase$2d$admin$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["supabaseAdmin"].from('system_health').insert(result);
        if (error) {
            console.error('[Health Check] Direct insert failed:', error);
            // Tentar via RPC como fallback
            try {
                const { error: rpcError } = await __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$supabase$2d$admin$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["supabaseAdmin"].rpc('insert_system_health', {
                    p_check_type: result.check_type,
                    p_endpoint: result.endpoint,
                    p_status: result.status,
                    p_response_time_ms: result.response_time_ms,
                    p_status_code: result.status_code,
                    p_error_message: result.error_message
                });
                if (rpcError) console.error('[Health Check] RPC failed:', rpcError);
            } catch (e) {
                console.error('[Health Check] RPC exception:', e);
            }
        }
    }
    // Calcular status geral
    const unhealthyCount = results.filter((r)=>r.status === 'unhealthy').length;
    const degradedCount = results.filter((r)=>r.status === 'degraded').length;
    let overallStatus = 'healthy';
    if (unhealthyCount > 0) overallStatus = 'unhealthy';
    else if (degradedCount > 0) overallStatus = 'degraded';
    return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
        status: overallStatus,
        timestamp: new Date().toISOString(),
        duration_ms: Date.now() - startTime,
        checks: results,
        summary: {
            total: results.length,
            healthy: results.filter((r)=>r.status === 'healthy').length,
            degraded: degradedCount,
            unhealthy: unhealthyCount
        }
    });
}
}}),
"[project]/ (server-utils)": ((__turbopack_context__) => {

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, t: require } = __turbopack_context__;
{
}}),

};

//# sourceMappingURL=%5Broot%20of%20the%20server%5D__c18da1._.js.map