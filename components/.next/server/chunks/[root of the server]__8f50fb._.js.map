{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 47, "column": 0}, "map": {"version":3,"sources":["turbopack://[project]/lib/supabase-admin.ts"],"sourcesContent":["import { createClient } from '@supabase/supabase-js';\n\n// URL e Service Key do Supabase (server-side only)\nconst supabaseUrl = process.env.SUPABASE_URL || process.env.NEXT_PUBLIC_SUPABASE_URL || 'http://kong:8000';\nconst supabaseServiceKey =\n  process.env.SUPABASE_SERVICE_ROLE_KEY ||\n  process.env.SUPABASE_SECRET_KEY ||\n  process.env.SUPABASE_SERVICE_KEY ||\n  '';\n\nif (!supabaseServiceKey) {\n  console.warn('??  SUPABASE_SERVICE_ROLE_KEY or SUPABASE_SECRET_KEY not set - admin client will not work');\n}\n\n// Cliente Supabase Admin (bypassa Row Level Security)\n// APENAS para uso server-side (API routes, server components)\nexport const supabaseAdmin = createClient(supabaseUrl, supabaseServiceKey, {\n  auth: {\n    autoRefreshToken: false,\n    persistSession: false,\n  },\n});\n\n/**\n * Tipos de dados do banco\n */\n\nexport interface User {\n  id: string;\n  email: string;\n  displayName: string;\n  role: 'developer' | 'admin' | 'manager' | 'agent' | 'buyer';\n  companyId: string | null;\n  storeId: string | null;\n  storeIds: string[];\n  active: boolean;\n  createdAt: string;\n  lastSeen: string | null;\n  isOnline?: boolean;\n}\n\nexport interface Company {\n  id: string;\n  name: string;\n  tradingName?: string;\n  cnpj?: string;\n  active: boolean;\n  createdAt: string;\n  updatedAt: string;\n}\n\nexport interface Store {\n  id: string;\n  name: string;\n  code: string;\n  companyId: string;\n  managerId?: string | null;\n  agentId?: string | null;\n  address?: string;\n  city?: string;\n  state?: string;\n  active: boolean;\n  createdAt: string;\n  updatedAt: string;\n}\n\ntype DbUser = {\n  id: string;\n  email: string;\n  display_name: string | null;\n  role: string;\n  company_id: string | null;\n  store_id: string | null;\n  store_ids: string[] | null;\n  active: boolean | null;\n  created_at: string;\n  last_seen: string | null;\n};\n\ntype DbCompany = {\n  id: string;\n  name: string;\n  cnpj: string | null;\n  trading_name: string | null;\n  active: boolean | null;\n  created_at: string;\n  updated_at: string;\n};\n\ntype DbStore = {\n  id: string;\n  name: string;\n  code: string;\n  company_id: string;\n  manager_id: string | null;\n  agent_id: string | null;\n  address: string | null;\n  city: string | null;\n  state: string | null;\n  active: boolean | null;\n  created_at: string;\n  updated_at: string;\n};\n\nfunction mapUserRow(row: DbUser): User {\n  const lastSeen = row.last_seen ?? null;\n  const isOnline = lastSeen ? (Date.now() - new Date(lastSeen).getTime() < 5 * 60 * 1000) : false;\n  return {\n    id: row.id,\n    email: row.email,\n    displayName: row.display_name || row.email || 'Sem nome',\n    role: row.role as User['role'],\n    companyId: row.company_id,\n    storeId: row.store_id,\n    storeIds: Array.isArray(row.store_ids) ? row.store_ids : (row.store_id ? [row.store_id] : []),\n    active: row.active !== false,\n    createdAt: row.created_at,\n    lastSeen,\n    isOnline,\n  };\n}\n\nfunction mapCompanyRow(row: DbCompany): Company {\n  return {\n    id: row.id,\n    name: row.name,\n    tradingName: row.trading_name ?? undefined,\n    cnpj: row.cnpj ?? undefined,\n    active: row.active !== false,\n    createdAt: row.created_at,\n    updatedAt: row.updated_at,\n  };\n}\n\nfunction mapStoreRow(row: DbStore): Store {\n  return {\n    id: row.id,\n    name: row.name,\n    code: row.code,\n    companyId: row.company_id,\n    managerId: row.manager_id ?? null,\n    agentId: row.agent_id ?? null,\n    address: row.address ?? undefined,\n    city: row.city ?? undefined,\n    state: row.state ?? undefined,\n    active: row.active !== false,\n    createdAt: row.created_at,\n    updatedAt: row.updated_at,\n  };\n}\n\n/**\n * Helper Functions para opera‡äes comuns\n */\n\n// ========================================\n// USERS\n// ========================================\n\nexport async function getAllUsers() {\n  const { data, error } = await supabaseAdmin\n    .from('users')\n    .select('*')\n    .order('created_at', { ascending: false });\n\n  if (error) throw error;\n  return (data || []).map(mapUserRow);\n}\n\nexport async function getUserById(userId: string) {\n  const { data, error } = await supabaseAdmin\n    .from('users')\n    .select('*')\n    .eq('id', userId)\n    .single();\n\n  if (error) throw error;\n  return mapUserRow(data as DbUser);\n}\n\nexport async function getUsersByCompany(companyId: string) {\n  const { data, error } = await supabaseAdmin\n    .from('users')\n    .select('*')\n    .eq('company_id', companyId)\n    .order('created_at', { ascending: false });\n\n  if (error) throw error;\n  return (data || []).map(mapUserRow);\n}\n\nexport async function createUser(user: Partial<User>) {\n  const payload = {\n    id: user.id,\n    email: user.email,\n    display_name: user.displayName ?? null,\n    role: user.role,\n    company_id: user.companyId ?? null,\n    store_id: user.storeId ?? null,\n    store_ids: user.storeIds ?? (user.storeId ? [user.storeId] : []),\n    active: user.active ?? true,\n  };\n  const { data, error } = await supabaseAdmin\n    .from('users')\n    .insert(payload)\n    .select()\n    .single();\n\n  if (error) throw error;\n  return mapUserRow(data as DbUser);\n}\n\nexport async function updateUser(userId: string, updates: Partial<User>) {\n  const payload: Partial<DbUser> & { updated_at?: string } = {\n    display_name: updates.displayName,\n    role: updates.role,\n    company_id: updates.companyId ?? undefined,\n    store_id: updates.storeId ?? undefined,\n    store_ids: updates.storeIds,\n    active: typeof updates.active === 'boolean' ? updates.active : undefined,\n    updated_at: new Date().toISOString(),\n  };\n  const { data, error } = await supabaseAdmin\n    .from('users')\n    .update(payload)\n    .eq('id', userId)\n    .select()\n    .single();\n\n  if (error) throw error;\n  return mapUserRow(data as DbUser);\n}\n\nexport async function deleteUser(userId: string) {\n  const { error } = await supabaseAdmin\n    .from('users')\n    .delete()\n    .eq('id', userId);\n\n  if (error) throw error;\n}\n\n// ========================================\n// COMPANIES\n// ========================================\n\nexport async function getAllCompanies() {\n  const { data, error } = await supabaseAdmin\n    .from('companies')\n    .select('*')\n    .order('name', { ascending: true });\n\n  if (error) throw error;\n  return (data || []).map(mapCompanyRow);\n}\n\nexport async function getCompanyById(companyId: string) {\n  const { data, error } = await supabaseAdmin\n    .from('companies')\n    .select('*')\n    .eq('id', companyId)\n    .single();\n\n  if (error) throw error;\n  return mapCompanyRow(data as DbCompany);\n}\n\nexport async function createCompany(company: Partial<Company>) {\n  const payload = {\n    id: company.id,\n    name: company.name,\n    trading_name: company.tradingName ?? null,\n    cnpj: company.cnpj ?? null,\n    active: company.active ?? true,\n  };\n  const { data, error } = await supabaseAdmin\n    .from('companies')\n    .insert(payload)\n    .select()\n    .single();\n\n  if (error) throw error;\n  return mapCompanyRow(data as DbCompany);\n}\n\nexport async function updateCompany(companyId: string, updates: Partial<Company>) {\n  const payload = {\n    name: updates.name,\n    trading_name: updates.tradingName ?? undefined,\n    cnpj: updates.cnpj ?? undefined,\n    active: typeof updates.active === 'boolean' ? updates.active : undefined,\n    updated_at: new Date().toISOString(),\n  };\n  const { data, error } = await supabaseAdmin\n    .from('companies')\n    .update(payload)\n    .eq('id', companyId)\n    .select()\n    .single();\n\n  if (error) throw error;\n  return mapCompanyRow(data as DbCompany);\n}\n\n// ========================================\n// STORES\n// ========================================\n\nexport async function getAllStores() {\n  const { data, error } = await supabaseAdmin\n    .from('stores')\n    .select('*')\n    .order('name', { ascending: true });\n\n  if (error) throw error;\n  return (data || []).map(mapStoreRow);\n}\n\nexport async function getStoresByCompany(companyId: string) {\n  const { data, error } = await supabaseAdmin\n    .from('stores')\n    .select('*')\n    .eq('company_id', companyId)\n    .order('name', { ascending: true });\n\n  if (error) throw error;\n  return (data || []).map(mapStoreRow);\n}\n\nexport async function getStoreById(storeId: string) {\n  const { data, error } = await supabaseAdmin\n    .from('stores')\n    .select('*')\n    .eq('id', storeId)\n    .single();\n\n  if (error) throw error;\n  return mapStoreRow(data as DbStore);\n}\n\nexport async function createStore(store: Partial<Store>) {\n  const payload = {\n    id: store.id,\n    name: store.name,\n    code: store.code,\n    company_id: store.companyId,\n    manager_id: store.managerId ?? null,\n    agent_id: store.agentId ?? null,\n    address: store.address ?? null,\n    city: store.city ?? null,\n    state: store.state ?? null,\n    active: store.active ?? true,\n  };\n  const { data, error } = await supabaseAdmin\n    .from('stores')\n    .insert(payload)\n    .select()\n    .single();\n\n  if (error) throw error;\n  return mapStoreRow(data as DbStore);\n}\n\nexport async function updateStore(storeId: string, updates: Partial<Store>) {\n  const payload = {\n    name: updates.name,\n    code: updates.code,\n    company_id: updates.companyId,\n    manager_id: updates.managerId ?? undefined,\n    agent_id: updates.agentId ?? undefined,\n    address: updates.address ?? undefined,\n    city: updates.city ?? undefined,\n    state: updates.state ?? undefined,\n    active: typeof updates.active === 'boolean' ? updates.active : undefined,\n    updated_at: new Date().toISOString(),\n  };\n  const { data, error } = await supabaseAdmin\n    .from('stores')\n    .update(payload)\n    .eq('id', storeId)\n    .select()\n    .single();\n\n  if (error) throw error;\n  return mapStoreRow(data as DbStore);\n}\n\n/**\n * Helper para verificar JWT token do usu rio\n */\nexport async function verifyToken(token: string) {\n  const { data: { user }, error } = await supabaseAdmin.auth.getUser(token);\n\n  if (error) throw error;\n  return user;\n}\n\nexport default supabaseAdmin;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 276, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 298, "column": 0}, "map": {"version":3,"sources":["turbopack://[project]/lib/helpers/auth.ts"],"sourcesContent":["// web/lib/helpers/auth.ts\nimport { Buffer } from 'buffer';\nimport { Role } from '@prisma/client';\nimport { z } from 'zod';\nimport { supabaseAdmin } from '@/lib/supabase-admin';\n\nconst AuthPayloadSchema = z.object({\n  userId: z.string(),\n  orgId: z.string(),\n  role: z.nativeEnum(Role),\n  storeIds: z.array(z.string()).default([]),\n  iat: z.number().optional(),\n  exp: z.number().optional(),\n});\nexport type AuthPayload = z.infer<typeof AuthPayloadSchema>;\n\n// Maps roles from Supabase/public.users to the Prisma Role enum\nconst roleMapping: Record<string, Role> = {\n  super_admin: Role.super_admin,\n  admin_rede: Role.admin_rede,\n  gestor_loja: Role.gestor_loja,\n  merchandiser: Role.merchandiser,\n  repositor: Role.repositor,\n  developer: Role.super_admin, // legacy role -> highest access\n  admin: Role.admin_rede,\n  manager: Role.gestor_loja,\n  agent: Role.repositor,\n  buyer: Role.merchandiser,\n};\n\nfunction mapRole(rawRole?: string | null): Role {\n  if (!rawRole) return Role.repositor; // Role padrao mais restritiva\n  const normalized = String(rawRole).toLowerCase();\n  return roleMapping[normalized] || Role.repositor;\n}\n\nfunction decodeJwtWithoutVerification(token: string): Record<string, unknown> | null {\n  try {\n    const parts = token.split('.');\n    if (parts.length < 2) return null;\n    const payload = parts[1];\n    const decoded = Buffer.from(payload.replace(/-/g, '+').replace(/_/g, '/'), 'base64').toString('utf8');\n    return JSON.parse(decoded);\n  } catch (error) {\n    console.error('Failed to decode bearer token:', error);\n    return null;\n  }\n}\n\ntype UserProfileRow = {\n  id: string;\n  role: string | null;\n  company_id: string | null;\n  store_id: string | null;\n  store_ids: string[] | null;\n};\n\nasync function fetchUserProfile(userId: string): Promise<UserProfileRow | null> {\n  try {\n    const { data, error } = await supabaseAdmin\n      .from('users')\n      .select('id, role, company_id, store_id, store_ids')\n      .eq('id', userId)\n      .maybeSingle();\n\n    if (error) {\n      console.error('Error fetching user profile from Supabase:', error);\n      return null;\n    }\n\n    return data as UserProfileRow;\n  } catch (error) {\n    console.error('Error fetching user profile from Supabase:', error);\n    return null;\n  }\n}\n\n/**\n * Extracts and parses the user authentication payload from the request headers.\n * Supports Firebase Auth tokens with x-user-payload header.\n */\nexport async function getAuthFromRequest(request: Request): Promise<AuthPayload | null> {\n  const authHeader = request.headers.get('authorization');\n  const bearer = authHeader?.startsWith('Bearer ') ? authHeader.slice(7) : null;\n  if (!bearer) return null;\n\n  // Decode JWT to get basic info (Firebase token)\n  const decodedFromBearer = decodeJwtWithoutVerification(bearer);\n  if (!decodedFromBearer) {\n    console.error('Failed to decode bearer token');\n    return null;\n  }\n\n  try {\n    // 1. Try to get user payload from x-user-payload header (set by frontend)\n    const userPayloadHeader = request.headers.get('x-user-payload');\n    if (userPayloadHeader) {\n      try {\n        const parsed = JSON.parse(userPayloadHeader);\n        const payload = {\n          userId: parsed.userId || decodedFromBearer['user_id'] || decodedFromBearer['sub'],\n          orgId: parsed.orgId || parsed.companyId || 'unknown-org',\n          role: mapRole(parsed.role),\n          storeIds: Array.isArray(parsed.storeIds) ? parsed.storeIds : [],\n          iat: decodedFromBearer?.['iat'] as number | undefined,\n          exp: decodedFromBearer?.['exp'] as number | undefined,\n        };\n\n        const validation = AuthPayloadSchema.safeParse(payload);\n        if (validation.success) {\n          return validation.data;\n        }\n      } catch (parseError) {\n        console.error('Failed to parse x-user-payload header:', parseError);\n      }\n    }\n\n    // 2. Extract user ID from Firebase token\n    const userId = decodedFromBearer['user_id'] || decodedFromBearer['sub'];\n    if (!userId || typeof userId !== 'string') {\n      console.error('No user ID found in token');\n      return null;\n    }\n\n    // 3. Fetch user profile from Supabase database\n    const profile = await fetchUserProfile(userId);\n\n    const roleValue =\n      profile?.role ||\n      (decodedFromBearer?.['role'] as string | undefined);\n\n    const orgIdValue =\n      profile?.company_id ||\n      (decodedFromBearer?.['orgId'] as string | undefined) ||\n      (decodedFromBearer?.['companyId'] as string | undefined) ||\n      (decodedFromBearer?.['company_id'] as string | undefined);\n\n    let storeIdsValue: string[] = [];\n    if (Array.isArray(profile?.store_ids) && profile?.store_ids.length > 0) {\n      storeIdsValue = profile.store_ids;\n    } else if (profile?.store_id) {\n      storeIdsValue = [profile.store_id];\n    }\n\n    const payload = {\n      userId: userId,\n      orgId: orgIdValue || 'unknown-org',\n      role: mapRole(roleValue),\n      storeIds: storeIdsValue,\n      iat: decodedFromBearer?.['iat'] as number | undefined,\n      exp: decodedFromBearer?.['exp'] as number | undefined,\n    };\n\n    const validation = AuthPayloadSchema.safeParse(payload);\n    if (!validation.success) {\n      console.error('Auth payload validation failed:', validation.error);\n      return null;\n    }\n\n    return validation.data;\n  } catch (error) {\n    console.error('Failed to validate auth payload:', error);\n    return null;\n  }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 430, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 436, "column": 0}, "map": {"version":3,"sources":["turbopack://[project]/app/api/usuarios/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { z } from 'zod';\nimport { supabaseAdmin } from '@/lib/supabase-admin';\nimport { getAuthFromRequest } from '@/lib/helpers/auth';\n\nconst allowedAdminRoles = new Set(['super_admin', 'admin_rede']);\n\nconst userSchema = z.object({\n  displayName: z.string().min(3, 'O nome deve ter pelo menos 3 caracteres'),\n  email: z.string().email('E-mail inv lido'),\n  password: z.string().min(6, 'A senha deve ter pelo menos 6 caracteres'),\n  role: z.enum(['developer', 'admin', 'manager', 'agent', 'buyer']),\n  companyId: z.string().optional(),\n  storeId: z.string().optional(),\n  storeIds: z.array(z.string()).optional(),\n});\n\ntype DbUser = {\n  id: string;\n  display_name: string | null;\n  email: string;\n  role: string;\n  company_id: string | null;\n  store_id: string | null;\n  store_ids: string[] | null;\n  active: boolean | null;\n  created_at: string;\n  last_seen: string | null;\n};\n\nfunction mapUser(row: DbUser) {\n  const lastSeen = row.last_seen ?? null;\n  const isOnline = lastSeen ? (Date.now() - new Date(lastSeen).getTime() < 5 * 60 * 1000) : false;\n  return {\n    id: row.id,\n    displayName: row.display_name || row.email || 'Sem nome',\n    email: row.email,\n    role: row.role,\n    storeId: row.store_id || null,\n    storeIds: Array.isArray(row.store_ids) ? row.store_ids : (row.store_id ? [row.store_id] : []),\n    companyId: row.company_id || null,\n    active: row.active !== false,\n    createdAt: row.created_at,\n    lastSeen,\n    isOnline,\n  };\n}\n\nexport async function POST(req: NextRequest) {\n  try {\n    const requester = await getAuthFromRequest(req);\n    if (!requester || !allowedAdminRoles.has(requester.role)) {\n      return NextResponse.json({ error: 'NÆo autorizado' }, { status: 401 });\n    }\n\n    const body = await req.json();\n    const validation = userSchema.safeParse(body);\n\n    if (!validation.success) {\n      return NextResponse.json({ error: validation.error.issues[0].message }, { status: 400 });\n    }\n\n    const { displayName, email, password, role, companyId, storeId, storeIds: inputStoreIds } = validation.data;\n\n    const isSuperAdmin = requester.role === 'super_admin';\n    const resolvedCompanyId = isSuperAdmin ? (companyId || null) : requester.orgId;\n    if (!resolvedCompanyId && !isSuperAdmin) {\n      return NextResponse.json({ error: 'Empresa obrigat¢ria para criar usu rio' }, { status: 400 });\n    }\n\n    const hasStores = storeId || (inputStoreIds && inputStoreIds.length > 0);\n    if ((role === 'manager' || role === 'agent') && !hasStores) {\n      return NextResponse.json({ error: 'Loja é obrigatória para perfis Manager/Agent' }, { status: 400 });\n    }\n    if (!isSuperAdmin && (role === 'developer' || role === 'admin')) {\n      return NextResponse.json({ error: 'Somente super admin pode criar usu rios admin/developer' }, { status: 403 });\n    }\n\n    const { data: existingProfile } = await supabaseAdmin\n      .from('users')\n      .select('id')\n      .eq('email', email)\n      .maybeSingle();\n\n    if (existingProfile) {\n      return NextResponse.json({ error: 'Este e-mail já está cadastrado no sistema.' }, { status: 409 });\n    }\n\n    // Verificar se existe usuário órfão no Auth (deletado da tabela users mas não do auth)\n    const { data: authUsers } = await supabaseAdmin.auth.admin.listUsers();\n    const orphanAuthUser = authUsers?.users?.find(u => u.email === email);\n\n    if (orphanAuthUser) {\n      // Usuário existe no Auth mas não na tabela users - deletar do Auth primeiro\n      console.log(`[API /usuarios] Removendo usuário órfão do Auth: ${email}`);\n      const { error: deleteError } = await supabaseAdmin.auth.admin.deleteUser(orphanAuthUser.id);\n      if (deleteError) {\n        console.error('Erro ao remover usuário órfão:', deleteError);\n        return NextResponse.json({\n          error: 'Este e-mail possui um registro antigo. Tente novamente ou contate o suporte.'\n        }, { status: 409 });\n      }\n    }\n\n    const { data: createdAuth, error: createAuthError } = await supabaseAdmin.auth.admin.createUser({\n      email,\n      password,\n      email_confirm: true,\n      user_metadata: { display_name: displayName },\n      app_metadata: { role },\n    });\n\n    if (createAuthError || !createdAuth.user) {\n      return NextResponse.json({ error: createAuthError?.message || 'Falha ao criar usu rio' }, { status: 500 });\n    }\n\n    // Prioriza storeIds se fornecido, senão usa storeId\n    const finalStoreIds = inputStoreIds && inputStoreIds.length > 0\n      ? inputStoreIds\n      : (storeId ? [storeId] : []);\n    const primaryStoreId = finalStoreIds.length > 0 ? finalStoreIds[0] : null;\n\n    const { data: createdProfile, error: profileError } = await supabaseAdmin\n      .from('users')\n      .insert({\n        id: createdAuth.user.id,\n        email,\n        display_name: displayName,\n        role,\n        company_id: resolvedCompanyId,\n        store_id: primaryStoreId,\n        store_ids: finalStoreIds,\n        active: true,\n      })\n      .select()\n      .single();\n\n    if (profileError || !createdProfile) {\n      await supabaseAdmin.auth.admin.deleteUser(createdAuth.user.id);\n      return NextResponse.json({ error: profileError?.message || 'Falha ao criar usu rio' }, { status: 500 });\n    }\n\n    return NextResponse.json({ usuario: mapUser(createdProfile as DbUser) }, { status: 201 });\n  } catch (error: any) {\n    console.error('Erro ao criar usu rio:', error);\n    return NextResponse.json({ error: error.message || 'Falha ao criar usu rio' }, { status: 500 });\n  }\n}\n\nexport async function GET(req: NextRequest) {\n  try {\n    const requester = await getAuthFromRequest(req);\n    if (!requester || !allowedAdminRoles.has(requester.role)) {\n      return NextResponse.json({ error: 'NÆo autorizado' }, { status: 401 });\n    }\n\n    let query = supabaseAdmin\n      .from('users')\n      .select('*')\n      .order('created_at', { ascending: false });\n\n    if (requester.role !== 'super_admin' && requester.orgId) {\n      query = query.eq('company_id', requester.orgId);\n    }\n\n    const { data, error } = await query;\n    if (error) {\n      throw error;\n    }\n\n    const usuarios = (data || []).map((row) => mapUser(row as DbUser));\n\n    return NextResponse.json({ usuarios });\n  } catch (error) {\n    console.error('Erro ao listar usu rios:', error);\n    return NextResponse.json({ error: 'Falha ao listar usu rios' }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 642, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}}]
}